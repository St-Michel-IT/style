% The 4 lines below speed up the compilation, a lot! It stops the compiler from
% compressing the builded PDF file.
\RequirePackage{expl3}
\ExplSyntaxOn
\pdf_uncompress:
\ExplSyntaxOff

% Style
\RequirePackage        {xcolor}

\usetheme{Madrid}
\RequirePackage        {dirtree}
% Color
\definecolor{flatblue}{RGB}{106, 137, 204}
\usecolortheme[named=flatblue]{structure}
% Font
\RequirePackage        {emoji}
\RequirePackage        {fontspec}
\RequirePackage        {csquotes}
\setsansfont{Garamond Libre}
% Code
\RequirePackage        {listings}
\RequirePackage        {graphicx}
\RequirePackage        {hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=flatblue,
    filecolor=flatblue,
    urlcolor=flatblue,
    citecolor=flatblue
}
\definecolor{flatgreen}{RGB}{0, 98, 102}
\definecolor{flatgreyish}{RGB}{209, 216, 224}
\lstset{
    basicstyle=\ttfamily\scriptsize,
    backgroundcolor=\color{flatgreyish},
    keywordstyle=\color{flatgreen},        % Keywords font ('*' = uppercase)
    commentstyle=\color{flatblue},         % Step between two line-numbers
    columns=fullflexible,
    breaklines=true,
    showstringspaces=false
}

% Custom header and footer
\makeatletter
\setbeamertemplate{footline}
{
    \leavevmode%
    \hbox{%
        \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,center]{section in head/foot}%
            \usebeamerfont{author in head/foot}\insertshortauthor~~\beamer@ifempty{\insertshortinstitute}{}{(\insertshortinstitute)}
        \end{beamercolorbox}%
        \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,center]{section in head/foot}%
            \usebeamerfont{title in head/foot}\insertshorttitle
        \end{beamercolorbox}%
        \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,right]{section in head/foot}%
            \usebeamerfont{date in head/foot}\insertshortdate{}\hspace*{2em}
            \insertframenumber{} / \inserttotalframenumber\hspace*{2ex}
        \end{beamercolorbox}}%
    \vskip0pt%
}
\makeatother

% Modify Beamer template
% Items
\setbeamertemplate{itemize items}[square]
\setbeamertemplate{enumerate items}[square]
\setbeamertemplate{itemize subitem}[circle]
\setbeamertemplate{enumerate subitem}[circle]
\setbeamertemplate{itemize subsubitem}[triangle]
\setbeamertemplate{enumerate subsubitem}[triangle]
% TOC
\setbeamertemplate{section in toc}[circle]
\setbeamertemplate{subsection in toc}[square]
% Title
\setbeamertemplate{title page}[default][colsep=-4bp,rounded=true]

% Highlight
\RequirePackage        [most]{tcolorbox}
\RequirePackage        {cleveref}
\crefformat{footnote}{#2\footnotemark[#1]#3}
% Define a new command that return a superscripted ", " (comma and space)
\newcommand{\footnotestep}{\textsuperscript{, }}
\RequirePackage        {amsmath}
\RequirePackage        {wasysym}
\definecolor{flatorange}{RGB}{255, 165, 2}
\definecolor{flatred}{RGB}{255, 71, 87}
\tcbset{textmarker/.style={%
skin=enhancedmiddle jigsaw,breakable,parbox=false,
boxrule=0mm,leftrule=2mm,rightrule=0mm,boxsep=0mm,arc=0mm,outer arc=0mm,
left=1mm,right=1mm,top=1mm,bottom=1mm,toptitle=1mm,bottomtitle=1mm}}
\newtcolorbox{dangercolorbox}{textmarker,colback=flatorange,colframe=flatred}

% The exercice counter
\newcounter{execounter} % Create a new counter
% Increment the counter and display it
\newcommand\execcounterdispinc{\stepcounter{execounter}\theexecounter}
% Only subsections in the table of contents
\setcounter{tocdepth}{2}
% Global transition
\addtobeamertemplate{background canvas}{\transfade[duration=2]}{}